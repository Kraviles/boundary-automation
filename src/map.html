<!DOCTYPE html>
<html>
<head>
    <title>Boundary Map</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="leaflet.css" />
    <style>
        #map { height: 100vh; }
    </style>
</head>
<body>
    <div id="map"></div>
    <script src="leaflet.js"></script>
    <script src="qrc:///qtwebchannel/qwebchannel.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var map = L.map('map').setView([0, 0], 2);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            var mainLayer = null;
            var comparisonLayer = null;

            new QWebChannel(qt.webChannelTransport, function (channel) {
                window.bridge = channel.objects.bridge;

                window.bridge.loadGeoJson.connect(function(data) {
                    // Clear existing layers
                    if (mainLayer) {
                        map.removeLayer(mainLayer);
                    }
                    if (comparisonLayer) {
                        map.removeLayer(comparisonLayer);
                    }
                    
                    var bounds = [];

                    try {
                        if (data.main) {
                            var mainGeoJson = JSON.parse(data.main);
                            mainLayer = L.geoJSON(mainGeoJson, {
                                style: { color: "#ff7800", weight: 2, opacity: 0.8 }
                            }).addTo(map);
                            bounds.push(mainLayer.getBounds());
                        }

                        if (data.comparison) {
                            var comparisonGeoJson = JSON.parse(data.comparison);
                            comparisonLayer = L.geoJSON(comparisonGeoJson, {
                                style: { color: "#0033ff", weight: 2, opacity: 0.8, dashArray: '4' }
                            }).addTo(map);
                            bounds.push(comparisonLayer.getBounds());
                        }

                    } catch (e) {
                        console.error("Error parsing GeoJSON: ", e);
                    }
                    
                    if (bounds.length > 0) {
                        var combinedBounds = bounds.reduce(function(acc, b) {
                            return acc.extend(b);
                        });
                        map.fitBounds(combinedBounds);
                    }
                });
            });
        });
    </script>
</body>
</html>
